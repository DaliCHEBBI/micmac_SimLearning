\chapter{Mesh related commands}


CNR  CERN 


%-----------------------------------------------------------------------
%-----------------------------------------------------------------------
%-----------------------------------------------------------------------

\section{Process of 3D meshes}

 {\tt MMVII} is not a point-cloud/mesh processing tool. However, during some devlopment, some
functionnalities appeared to be necessary and not easily accesible on open source.
As they may be usable in other context I describe them here.

%-----------------------------------------------------------------------
\subsection{MeshCheck}

\begin{verbatim}
 == Mandatory unnamed args : ==
  * string [FDP,Cloud] :: Name of input cloud/mesh
 == Optional named args : ==
  * [Name=Bin] bool :: Generate out in binary format ,[Default=false]
  * [Name=Out] string :: Name of output file if correction are done
  * [Name=Do2DC] bool :: check also as a 2D-triangulation (orientation) ,[Default=false]
  * [Name=Correct] bool :: Do correction, Defaut: Do It Out specified
\end{verbatim}

{\tt MicMac-V1} can generate mesh from a 3d point cloud with normal. For this it
uses the open source tool devlopped by M Kazhdan. Also this tool is robust,
it has sometime topologicall problem that can block further processing.
The command {\tt MeshCheck} has been developped to  detect and potentially
correct these problems.

The first problem detected   is the fact that the same point that is duplicate in
a single triangle  like $ABC$  with $P_A=P_B$. This point are detected and
if the option {\tt Correct} is activated, a graph-quotient algorithm is applied 
on point that are detected as multiple.

The second check is $3d$ surface orientatbility . A message indicating the detected
pair of adjacent triangle badly oriented is printed.  No correction is
done, because untill now no such problem was encounterred.

If the option {\tt Do2DC} is activated, the triangulation is considered
as a $2$ triangle (setting $z$ to $0$) and  the $2d$ orientation correctness is
tested (have all the triangle the same orientation).


%-----------------------------------------------------------------------
\subsection{MeshCloudClip}

\begin{verbatim}
 == Mandatory unnamed args : ==
  * string [FDP,Cloud] :: Name of input cloud/mesh
  * string [3DReg] :: Name of 3D masq

 == Optional named args : ==
  * [Name=Out] string :: Name of output file
  * [Name=Bin] bool :: Generate out in binary format ,[Default=false]
\end{verbatim}


The mesh generated by Poisson method generate a smooth extension of the surface
that can be problematic, for example in the surface devlopment process. This
commande allow to clip the mesh using a $3d$ region.  For now the region
must come in the {\tt MicMac-V1} format as seized by {\tt mm3d SaisieMasqQT}
as for now there is no well established format for $3d$ volumes.
Figure~\ref{fig:MeshClip} illustrate the result of {\tt MeshCloudClip}

\begin{figure}
\centering
\includegraphics[width=6cm]{CommandReferences/ImagesComRef/MeshWithSkirt.jpg}
\includegraphics[width=6cm]{CommandReferences/ImagesComRef/MeshCliped.jpg}
\caption{Letft mesh with undesirable extension, right mesh after clipping}
\label{fig:MeshClip}
\end{figure}



%-----------------------------------------------------------------------
%-----------------------------------------------------------------------
%-----------------------------------------------------------------------

\section{Mesh development}

This section describe the tools that were devloped for surface devlopment.

%-----------------------------------------------------------------------
\subsection{MeshDevGen}
This "tiny" tool was made to check the correctness of the surface devlopment algorithm. 
It generate a synthetic mesh, that is completely devlopable and for with we
know the 2 devlopment. This surface is a $3$ extrusion of a logarithmic spiral.

Figure~\ref{fig:SpirAndDev} represent the 3D surface and its developped 2d surface.

\begin{figure}
\centering
\includegraphics[width=6cm]{CommandReferences/ImagesComRef/Cyl3D01.jpg}
\includegraphics[width=6cm]{CommandReferences/ImagesComRef/CylDev00.jpg}
\caption{A synthetic 3D mesh, and its generated devloped surface}
\label{fig:SpirAndDev}
\end{figure}

%-----------------------------------------------------------------------
\subsection{MeshDev}


This tool is used to make the $2d$ development of a $3d$ surface. As the real surface
is generally not strictly devlopable, this is done by minimzing the energy of deformation.
More precisely :

\begin{itemize}
      \item let  $P_i$ be the $3d$ points of the triangulation, $P_i \in \RR^3$;
      \item let  $\phi(P_i)$ be unknown $2d$  position of the devlopment $\phi(P_i) \in \RR^2$;
      \item let  $T_k = \{P_{k_1},P_{k_2},P_{k_3}\}$ be the triangles;
\end{itemize}

For each triangle  $T_k$ \emph{independantly} we can easily compute a perfect development
$q^k_1,q^k_2,q^k_3$, such that $d(q^k_m,q^k_n)=d(P_{k_m},P_{k_n}) \; m,n \in (1,2,3)$. If the development
were perfect, there would exist for each triangle a rotation $R^k$ such that :

\begin{equation}
	\phi(P_{k_m}) =  R^k q^k_m  \;\; m \in (1,2,3) \label{Eq:MeshDev1T}
\end{equation}


The then try to compute the $\phi(P_i)$ and $R_k$ that minisze globaly the equation)~\ref{Eq:MeshDev1T} :

\begin{equation}
    \sum_k \sum_{m=1}^3  ||\phi(P_{k_m}) - R^k q^k_m|| ^2
\end{equation}


\COM{
MeshDev => Generate a planar devlopment minimizing deformations
MeshImageDevlp =>  Compute devlopped images from 3d-mesh, 2d-dev-mesh and ori
MeshProjImage => (internal) Project a mes on an image to prepare devlopment

}




